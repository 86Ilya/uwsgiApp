# UWSGI приложение ip2w
Данное uwsgi приложение является простым сервисом выяснения погоды по ip адресу.

## Сборка
В качестве окружения для сборки используется *CentOS 7*
Для сборки rpm данного приложения необходимо из корня гит репозитория запустить команду:
```bash
sh buildrpm.sh ip2w.spec
```
## Сборка с использованием Docker контейнера
Для создания необходимого окружения сборки и запуска в комплекте имеется `Dockerfile`.
Для сборки контейнера достаточно запустить команду:
```bash
sh ./deploy.sh
```
После окончания сборки будут запущены тесты и будет указан эндпоинт данного сервиса.

## Установка и запуск
Конфиг сервиса находится по адресу `/usr/local/etc/ip2w.conf`
После установки сам сервис запускается и слушает локальный сокет `/tmp/ip2w_uwsgi.sock`, а nginx
проксирует все запросы с 80 порта на этот сокет.

### Примеры запуска сервера
Сервис запускается автоматически используя *systemd*.
Если по каким либо причинам вам надо запустить его вручную, то достаточно выполнить команду:
```bash
/usr/bin/uwsgi --ini /usr/local/etc/ip2w.ini
```
После запуска сервиса его работу можно проверить так:
```bash
curl http://localhost/ip2w/5.18.102.113
{"city": "Saint Petersburg", "conditions": "Clouds", "temp": "1.81"}
```

## Запуск тестов
Для запуска тестов необходимо проверить запущен ли сервис и если нет, то запустить его:
```bash
service ip2w start
```
После этого запустить непосредственно сами тесты
```bash
pytest -v -s tests/
```